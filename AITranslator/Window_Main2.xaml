<Window x:Class="AITranslator.Window_Main2"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AITranslator"
        xmlns:calc="clr-namespace:CalcBinding;assembly=CalcBinding"
        xmlns:tb="clr-namespace:H.NotifyIcon;assembly=H.NotifyIcon.Wpf"
        xmlns:vm="clr-namespace:AITranslator.View.Models" 
        xmlns:uc="clr-namespace:AITranslator.View.UserControls" xmlns:converter="clr-namespace:AITranslator.View.Converter" xmlns:controls="clr-namespace:AITranslator.View.Controls"
        mc:Ignorable="d"
        Title="AI Translator" Height="600" Width="400" WindowStyle="None" ResizeMode="NoResize" WindowStartupLocation="CenterScreen" Background="Transparent" AllowsTransparency="True" Closing="window_main_Closing">
    <Window.RenderTransform>
        <TransformGroup>
            <ScaleTransform CenterX="{calc:Binding ActualWidth/2,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type Window}}}" CenterY="{calc:Binding ActualHeight/2,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type Window}}}" x:Name="window_scale"/>
            <TranslateTransform x:Name="window_translate"/>
        </TransformGroup>
    </Window.RenderTransform>
    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded" >
            <BeginStoryboard>
                <Storyboard x:Name="anim">
                    <DoubleAnimation Duration="00:00:0.3"  Storyboard.TargetProperty="Opacity" From="0" To="1" />
                    <DoubleAnimation Storyboard.TargetName="window_scale" Duration="00:00:0.3" Storyboard.TargetProperty="ScaleX" From="0.9" To="1" />
                    <DoubleAnimation Storyboard.TargetName="window_scale" Duration="00:00:0.3" Storyboard.TargetProperty="ScaleY" From="0.9" To="1" />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Window.Triggers>
    <Window.DataContext>
        <vm:ViewModel/>
    </Window.DataContext>
    <Border x:Name="border_Main" CornerRadius="10" BorderThickness="0">
        <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Offset="1" Color="#FF21252D"/>
                <GradientStop Offset="0" Color="#FF273146"/>
            </LinearGradientBrush>
        </Border.Background>
        <Border.BorderBrush>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Offset="0" Color="#FF6B6C6D"/>
                <GradientStop Offset="1" Color="#FF464646"/>
            </LinearGradientBrush>
        </Border.BorderBrush>
        <Grid>
            <Grid.Clip>
                <RectangleGeometry Rect="0 0 400 1000" RadiusX="9" RadiusY="9"/>
            </Grid.Clip>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30"/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <!--托盘图标-->
                <tb:TaskbarIcon x:Name="tbIcon" PopupPlacement="MousePoint" Visibility="Collapsed" PopupActivation="RightClick" IconSource="pack://application:,,,/AITranslator;component/View/Resources/Icon/Icon.ico" TrayLeftMouseDown="tbIcon_TrayLeftMouseDoubleClick">
                    <tb:TaskbarIcon.ToolTipText>
                        <MultiBinding Converter="{StaticResource TaskbarIconToolTipText}">
                            <Binding Path="IsTranslating"/>
                            <Binding Path="IsBreaked"/>
                            <Binding Path="Progress"/>
                        </MultiBinding>
                    </tb:TaskbarIcon.ToolTipText>
                    <tb:TaskbarIcon.TrayPopup>
                        <Border Padding="5,8" CornerRadius="5" Width="120">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Offset="1" Color="#FF21252D"/>
                                    <GradientStop Offset="0" Color="#FF273146"/>
                                </LinearGradientBrush>
                            </Border.Background>

                            <StackPanel Grid.Row="0">
                                <controls:ViewButton  Height="25" IsEnabled="True" Visibility="{calc:Binding 'Height != 0',FalseToVisibility=Collapsed,RelativeSource={RelativeSource Mode=Self}}" Style="{StaticResource TaskbarButton}" Click="Button_Start_Taskbar_Click">
                                    <controls:ViewButton.Content>
                                        <MultiBinding Converter="{StaticResource StartButtonText}" ConverterParameter="暂停 继续 开始 查看">
                                            <Binding Path="IsTranslating"/>
                                            <Binding Path="IsBreaked"/>
                                            <Binding Path="Progress"/>
                                        </MultiBinding>
                                    </controls:ViewButton.Content>
                                </controls:ViewButton>
                                <controls:ViewButton IsEnabled="{calc:Binding 'Progress >= 100 or (IsBreaked and !IsTranslating)'}"  Visibility="{calc:Binding 'Height != 0',FalseToVisibility=Collapsed,RelativeSource={RelativeSource Mode=Self}}" Height="25" Style="{StaticResource TaskbarButton}" Content="清除当前进度" Click="Button_Clear_Taskbar_Click"/>
                                <controls:ViewButton Height="25" Style="{StaticResource TaskbarButton}" Content="退出" Click="Button_Close_Taskbar_Click"/>
                            </StackPanel>
                        </Border>
                    </tb:TaskbarIcon.TrayPopup>
                </tb:TaskbarIcon>
                <!--标题栏-->
                <Grid Background="#FF312D87" MouseLeftButtonDown="Header_MouseLeftButtonDown">
                    <StackPanel Orientation="Horizontal" Margin="10,3,0,0" Grid.ColumnSpan="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Title,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type Window}}}" FontFamily="{StaticResource English}" VerticalAlignment="Center" FontSize="20" Foreground="#FFD2D9DC"/>
                        <TextBlock Margin="10,0,0,0" Text="{Binding Version,StringFormat=v{0}}" FontFamily="{StaticResource English}" FontSize="12" Foreground="#FFD2D9DC" VerticalAlignment="Center"/>
                        <TextBlock Margin="3,0,0,0" Text="Beta" Visibility="{calc:Binding IsBeta,FalseToVisibility=Collapsed}" FontFamily="{StaticResource English}" FontSize="12" Foreground="#FFD2D9DC" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Margin="5,0,2,0" Grid.Column="1" HorizontalAlignment="Right" Orientation="Horizontal" >
                        <Button Style="{StaticResource TitleBarButton}" ToolTip="软件声明" Click="Button_Declare_Click" Cursor="Hand">
                            <Button.Content>
                                <Viewbox Margin="0,4,0,0">
                                    <Path Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" Data="M512.172014 0C238.32555 0 12.987065 222.930287 12.987065 499.012935c0 273.846464 222.930287 499.012935 499.012935 499.012934 273.846464 0 499.012935-222.930287 499.012935-499.012934C1008.776751 222.930287 785.846464 0 512.172014 0m0 925.435915c-234.971275 0-426.42298-191.451705-426.42298-426.42298S277.200739 72.761969 512.172014 72.761969 938.594994 264.04166 938.594994 499.012935 747.143289 925.435915 512.172014 925.435915M475.877037 775.267596h70.181757v-356.069209H475.877037v356.069209z m36.294977-523.266924c-14.621199 0-26.662187 4.816395-38.703175 14.621199-9.63279 9.63279-14.621199 24.25399-14.621199 38.703175 0 14.621199 4.816395 29.070385 14.621199 38.703175 9.63279 9.63279 24.25399 14.621199 38.703175 14.621199s26.662187-4.816395 38.703175-14.621199c9.63279-9.63279 14.621199-24.25399 14.621199-38.703175 0-14.621199-4.816395-26.662187-14.621199-38.703175-12.040988-9.804804-24.25399-14.621199-38.703175-14.621199"/>
                                </Viewbox>
                            </Button.Content>
                        </Button>
                        <Button Style="{StaticResource TitleBarButton}" Click="Button_Small_Click">
                            <Label Content="-" Margin="-5" Foreground="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontSize="18"/>
                        </Button>
                        <Button Style="{StaticResource TitleBarButton}" Click="Button_Close_Click">
                            <Label Content="×" Margin="-5" Foreground="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}}" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontSize="18"/>
                        </Button>
                    </StackPanel>
                </Grid>
                <!--主体-->
                <Grid  Grid.Row="1">
                    <DockPanel>
                        <!--模型加载区-->
                        <Border DockPanel.Dock="Left" BorderThickness="0,0,1,0"  BorderBrush="Black">
                            <StackPanel Width="50">
                                <controls:SidebarRadioButton x:Name="rb_TranslatingView" ToolTip="翻译中" IsChecked="True" Height="{Binding ActualWidth, RelativeSource={RelativeSource Mode=Self}}">
                                    <Viewbox Margin="8,8,12,12">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type controls:SidebarRadioButton}}}" Data="M512 141.211a370.789 370.789 0 1 1 0 741.578 370.789 370.789 0 0 1 0-741.578z m-185.394 324.44a46.349 46.349 0 1 0 0 92.698 46.349 46.349 0 0 0 0-92.698z m185.394 0a46.349 46.349 0 1 0 0 92.698 46.349 46.349 0 0 0 0-92.698z m185.394 0a46.349 46.349 0 1 0 0 92.698 46.349 46.349 0 0 0 0-92.698z"/>
                                    </Viewbox>
                                </controls:SidebarRadioButton>
                                <controls:SidebarRadioButton x:Name="rb_TranslatedView" ToolTip="翻译完成" Height="{Binding ActualWidth, RelativeSource={RelativeSource Mode=Self}}">
                                    <Viewbox Margin="12">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type controls:SidebarRadioButton}}}" Data="M512.54272 72.54016c-242.0736 0-438.30272 196.89984-438.30272 439.79776s196.22912 439.79776 438.30272 439.79776c242.06336 0 438.30272-196.89984 438.30272-439.79776S754.6112 72.54016 512.54272 72.54016zM706.65216 433.42336l-208.61952 209.85344 0-0.02048c-6.30784 6.3488-14.98624 10.25024-24.6272 10.25024-9.6 0-18.31424-3.9424-24.60672-10.25024L310.1952 503.66976c-6.28736-6.2976-10.16832-15.0016-10.16832-24.62208 0-19.3024 15.5904-34.91328 34.76992-34.91328 9.62048 0 18.31936 3.92192 24.6272 10.25024l113.98144 114.81088 184.01792-185.088c6.29248-6.3232 15.0272-10.21952 24.62208-10.21952 19.18464 0 34.75456 15.616 34.75456 34.87232C716.8 418.39616 712.91904 427.11552 706.65216 433.42336z"/>
                                    </Viewbox>
                                </controls:SidebarRadioButton>
                                <controls:SidebarRadioButton x:Name="rb_ManualTranslate" ToolTip="手动翻译" Height="{Binding ActualWidth, RelativeSource={RelativeSource Mode=Self}}">
                                    <Viewbox Margin="12">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type controls:SidebarRadioButton}}}" Data="M890.88 981.333333H132.693333C106.581333 981.333333 85.333333 960.384 85.333333 934.570667c0-25.813333 21.205333-46.762667 47.36-46.762667h758.186667c26.197333 0 47.402667 20.906667 47.402667 46.762667 0 25.813333-21.205333 46.762667-47.36 46.762666zM369.706667 833.28H180.053333c-26.154667 0-47.36-20.906667-47.36-46.762667v-186.965333c0-12.373333 4.992-24.32 13.866667-33.066667L620.458667 99.029333a47.829333 47.829333 0 0 1 66.986666 0l189.568 186.965334a46.293333 46.293333 0 0 1 0 66.133333L403.2 819.584c-8.874667 8.789333-20.906667 13.653333-33.493333 13.696z m-142.165334-93.482667h122.538667L776.533333 319.061333l-122.538666-120.917333-426.496 420.736v120.917333z"/>
                                    </Viewbox>
                                </controls:SidebarRadioButton>
                                <controls:SidebarRadioButton x:Name="rb_LogView" ToolTip="日志" Height="{Binding ActualWidth, RelativeSource={RelativeSource Mode=Self}}">
                                    <Viewbox Margin="10,10,13,13">
                                        <Path Fill="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type controls:SidebarRadioButton}}}" Data="M410.3 187.1h209.4c18.5 0 33.4-14.4 33.4-32.1v-53.9c0-17.7-15-32.1-33.4-32.1H410.3c-18.5 0-33.4 14.4-33.4 32.1V155c0 17.7 15 32.1 33.4 32.1zM787.7 132.8H680.8v35.8c0 22-18.5 39.8-41.4 39.8H390.7c-22.9 0-41.4-17.8-41.4-39.8v-35.8H242.4c-58.7 0-106.2 45.7-106.2 102v610.6c0 56.3 47.6 102 106.2 102h545.2c58.7 0 106.2-45.7 106.2-102V234.8c0.1-56.3-47.5-102-106.1-102z m-27.5 592.3H291.4c-14.8 0-26.8-11.5-26.8-25.7s12-25.7 26.8-25.7h468.9c14.8 0 26.8 11.5 26.8 25.7s-12.1 25.7-26.9 25.7z m0-168.6H291.4c-14.8 0-26.8-11.5-26.8-25.7s12-25.7 26.8-25.7h468.9c14.8 0 26.8 11.5 26.8 25.7s-12.1 25.7-26.9 25.7z m0-168.6H291.4c-14.8 0-26.8-11.5-26.8-25.7s12-25.7 26.8-25.7h468.9c14.8 0 26.8 11.5 26.8 25.7s-12.1 25.7-26.9 25.7z"/>
                                    </Viewbox>
                                </controls:SidebarRadioButton>
                            </StackPanel>
                        </Border>

                        <Grid DockPanel.Dock="Right">
                            <Grid Background="Yellow" Visibility="{calc:Binding IsChecked,ElementName=rb_TranslatingView,FalseToVisibility=Collapsed}">

                            </Grid>
                            <Grid Background="Aqua" Visibility="{calc:Binding IsChecked,ElementName=rb_TranslatedView,FalseToVisibility=Collapsed}">

                            </Grid>
                            <Grid Background="Red" Visibility="{calc:Binding IsChecked,ElementName=rb_ManualTranslate,FalseToVisibility=Collapsed}">

                            </Grid>
                            <Grid Background="Black" Visibility="{calc:Binding IsChecked,ElementName=rb_LogView,FalseToVisibility=Collapsed}">
                                <ListBox x:Name="list_Logs" Background="Transparent" BorderThickness="0" ItemsSource="{Binding Consoles}" ScrollViewer.CanContentScroll="False" VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Standard" ScrollViewer.HorizontalScrollBarVisibility="Hidden" ScrollViewer.VerticalScrollBarVisibility="Hidden">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock TextWrapping="Wrap" Foreground="Gray" FocusVisualStyle="{x:Null}"  Width="{calc:Binding '(ActualWidth - 5) less 0 ? 0 : (ActualWidth - 5)',ElementName=list_Consoles}" Text="{Binding}"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Grid>
                    </DockPanel>
                    <uc:UserControl_ModelLoader VerticalAlignment="Bottom" DataContext="{Binding DataContext,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type Window}}}"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
